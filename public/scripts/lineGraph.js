function renderLineGraph(queryData){let headers=new Array();headers['date']='date';headers['David Webster Hall']='WITS_WC_David_Webster_Hall_kWh';headers['13 Jubilee Road']='WITS_13_Jubilee_Road_kWh';headers['Junction ePitstop']='WITS_The_Junction_ePitstop_kWh';headers['Junction HT']='WITS_The_Junction_HT_kWh';headers['Barnarto Sub TRF 1']='WITS_WC_Barnato_Sub_TRF_1_kWh';headers['Barnarto Sub TRF 2']='WITS_WC_Barnato_Sub_TRF_2_kWh';headers['Barnarto Sub Res']='WITS_WC_Barnato_Sub_Residence_A___D_kWh';let margin={top:20,right:200,bottom:100,left:50},margin2={top:430,right:10,bottom:20,left:40},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,height2=500-margin2.top-margin2.bottom;let parseDate=d3.time.format("%Y%m%d").parse;let bisectDate=d3.bisector(function(d){return d;}).left;let xScale=d3.time.scale().range([0,width]),xScale2=d3.time.scale().range([0,width]);let yScale=d3.scale.linear().range([height,0]);let color=d3.scale.ordinal().range(colorArray);let xAxis=d3.svg.axis().scale(xScale).orient("bottom"),xAxis2=d3.svg.axis().scale(xScale2).orient("bottom");let yAxis=d3.svg.axis().scale(yScale).orient("left");let line=d3.svg.line().interpolate("basis").x(function(d){return xScale(d.date);}).y(function(d){return yScale(d.rating);}).defined(function(d){return d.rating;});let maxY;let svg=d3.select("#line-chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).call(makeResponsiveLine).append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("rect").attr("width",width).attr("height",height).attr("x",0).attr("y",0).attr("id","mouse-tracker").style("fill","white");let context=svg.append("g").attr("transform","translate("+0+","+410+")").attr("class","context");svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height);let data=[];for(let data_index=0;data_index<queryData.length;data_index++){data.push(queryData[data_index][0]);}color.domain(d3.keys(headers).filter(function(key){return key!=="date";}));data.forEach(function(d){d.dps.forEach(function(e){e[0]=new Date(e[0]);});});let categories=color.domain().map(function(name){return{name:name,values:data.find(function(element){return element.metric==headers[name];}).dps.map(function(d){return{date:d[0],rating:d[1],};}),visible:(name==="Barnarto Sub TRF 1"?true:false)};});xScale.domain(d3.extent(data[0].dps,function(d){return d[0];}));yScale.domain([0,d3.max(categories,function(c){return d3.max(c.values,function(v){return v.rating;});})]);xScale2.domain(xScale.domain());let brush=d3.svg.brush().x(xScale2).on("brush",brushed);context.append("g").attr("class","x axis1").attr("transform","translate(0,"+height2+")").call(xAxis2);let contextArea=d3.svg.area().interpolate("monotone").x(function(d){return xScale2(d.date);}).y0(height2).y1(0);context.append("path").attr("class","area").attr("d",contextArea(categories[0].values)).attr("fill","#F1F1F2");context.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("height",height2).attr("fill","#E6E7E8");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("x",-10).attr("dy",".71em").style("text-anchor","end").text("Energy Consumption (kWh)");let issue=svg.selectAll(".issue").data(categories).enter().append("g").attr("class","issue");issue.append("path").attr("class","line").style("pointer-events","none").attr("id",function(d){return"line-"+d.name.split(' ').join('');}).attr("d",function(d){return d.visible?line(d.values):null;}).attr("clip-path","url(#clip)").style("stroke",function(d){return color(d.name);});let legendSpace=450/categories.length;issue.append("rect").attr("width",10).attr("height",10).attr("x",width+(margin.right/3)-15).attr("y",function(d,i){return(legendSpace)+i*(legendSpace)-8;}).attr("fill",function(d){return d.visible?color(d.name):"#F1F1F2";}).attr("class","legend-box").on("click",function(d){d.visible=!d.visible;maxY=findMaxY(categories);yScale.domain([0,maxY]);svg.select(".y.axis").transition().call(yAxis);issue.select("path").transition().attr("d",function(d){return d.visible?line(d.values):null;})
issue.select("rect").transition().attr("fill",function(d){return d.visible?color(d.name):"#F1F1F2";});}).on("mouseover",function(d){d3.select(this).transition().attr("fill",function(d){return color(d.name);});d3.select("#line-"+d.name.split(' ').join('')).transition().style("stroke-width",2.5);}).on("mouseout",function(d){d3.select(this).transition().attr("fill",function(d){return d.visible?color(d.name):"#F1F1F2";});d3.select("#line-"+d.name.split(' ').join('')).transition().style("stroke-width",1.5);})
issue.append("text").attr("x",width+(margin.right/3)).attr("y",function(d,i){return(legendSpace)+i*(legendSpace);}).text(function(d){return d.name;});let hoverLineGroup=svg.append("g").attr("class","hover-line");let hoverLine=hoverLineGroup.append("line").attr("id","hover-line").attr("x1",10).attr("x2",10).attr("y1",0).attr("y2",height+10).style("pointer-events","none").style("opacity",1e-6);let hoverDate=hoverLineGroup.append('text').attr("class","hover-text").attr("y",height-(height-40)).attr("x",width-150).style("fill","#E6E7E8");let columnNames=d3.keys(headers).slice(1);let focus=issue.select("g").data(columnNames).enter().append("g").attr("class","focus");focus.append("text").attr("class","tooltip").attr("x",width+20).attr("y",function(d,i){return(legendSpace)+i*(legendSpace);});d3.select("#mouse-tracker").on("mousemove",mousemove).on("mouseout",function(){hoverDate.text(null)
d3.select("#hover-line").style("opacity",1e-6);});function mousemove(){let mouse_x=d3.mouse(this)[0];let graph_x=xScale.invert(mouse_x);let format=d3.time.format('%b %Y');hoverDate.text(format(graph_x));d3.select("#hover-line").attr("x1",mouse_x).attr("x2",mouse_x).style("opacity",1);let dates=data[0].dps.map(function(value,index){return value[0];});let x0=xScale.invert(d3.mouse(this)[0]),i=bisectDate(dates,x0,1),d0=dates[i-1],d1=dates[i],d=x0-d0[0]>d1[0]-x0?d1:d0;focus.select("text").text(function(columnName){return d[columnName];});}function brushed(){xScale.domain(brush.empty()?xScale2.domain():brush.extent());svg.select(".x.axis").transition().call(xAxis);maxY=findMaxY(categories);yScale.domain([0,maxY]);svg.select(".y.axis").transition().call(yAxis);issue.select("path").transition().attr("d",function(d){return d.visible?line(d.values):null;});}function findMaxY(data){let maxYValues=data.map(function(d){if(d.visible){return d3.max(d.values,function(value){return value.rating;})}});return d3.max(maxYValues);}}